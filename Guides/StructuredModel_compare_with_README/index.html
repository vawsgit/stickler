
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../Core-Concepts/Threshold_Gated_Recursive_Evaluation/">
      
      
        <link rel="next" href="../StructuredModel_Dynamic_Creation/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>StructuredModel Compare - Stickler</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#structuredmodel-compare_with-method-a-laymans-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Stickler" class="md-header__button md-logo" aria-label="Stickler" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Stickler
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              StructuredModel Compare
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/awslabs/stickler" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    awslabs/stickler
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Getting-Started/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Core-Concepts/" class="md-tabs__link">
          
  
  
  Core Concepts

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../SDK-Docs/" class="md-tabs__link">
          
  
  
  SDK Docs

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Stickler" class="md-nav__button md-logo" aria-label="Stickler" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Stickler
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/awslabs/stickler" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    awslabs/stickler
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Getting-Started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Core Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Core-Concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Core-Concepts/Classification_Logic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Classification Logic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Core-Concepts/hungarian_matching_list_of_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hungarian Matching
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Core-Concepts/Threshold_Gated_Recursive_Evaluation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Recursive Evaluation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    StructuredModel Compare
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    StructuredModel Compare
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-it-does" class="md-nav__link">
    <span class="md-ellipsis">
      What It Does
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-it-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why It Matters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      How It Works
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How It Works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-big-picture" class="md-nav__link">
    <span class="md-ellipsis">
      The Big Picture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-process-step-by-step" class="md-nav__link">
    <span class="md-ellipsis">
      The Process Step-by-Step
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flow-chart" class="md-nav__link">
    <span class="md-ellipsis">
      Flow Chart
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pseudocode-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Pseudocode Logic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pseudocode Logic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-compare_with-method" class="md-nav__link">
    <span class="md-ellipsis">
      Core compare_with Method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-recursive-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Core Recursive Comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-type-dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      Field Type Dispatch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-matching-hungarian-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      List Matching (Hungarian Algorithm)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structured-list-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Structured List Processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Key Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-field-types" class="md-nav__link">
    <span class="md-ellipsis">
      1. Field Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-hungarian-matching" class="md-nav__link">
    <span class="md-ellipsis">
      2. Hungarian Matching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-thresholds-and-weights" class="md-nav__link">
    <span class="md-ellipsis">
      3. Thresholds and Weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-confusion-matrix-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      4. Confusion Matrix Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-score-percolation" class="md-nav__link">
    <span class="md-ellipsis">
      5. Score Percolation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-simple-invoice-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Example 1: Simple Invoice Comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-list-comparison-with-hungarian-matching" class="md-nav__link">
    <span class="md-ellipsis">
      Example 2: List Comparison with Hungarian Matching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-nested-object-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Example 3: Nested Object Comparison
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      Core Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Helper Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#design-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Design Principles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-flow-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      Method Flow Breakdown
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Method Flow Breakdown">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-entry-point-compare_with" class="md-nav__link">
    <span class="md-ellipsis">
      1. Entry Point: compare_with()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-core-engine-compare_recursive" class="md-nav__link">
    <span class="md-ellipsis">
      2. Core Engine: compare_recursive()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-field-dispatcher-_dispatch_field_comparison" class="md-nav__link">
    <span class="md-ellipsis">
      3. Field Dispatcher: _dispatch_field_comparison()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-specialized-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      4. Specialized Handlers:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-hungarian-matching" class="md-nav__link">
    <span class="md-ellipsis">
      5. Hungarian Matching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-score-calculation-and-aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      6. Score Calculation and Aggregation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Optimizations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-output-structure-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Output Structure Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Output Structure Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-basic-output-default-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      1. Basic Output (Default Parameters)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-with-confusion-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      2. With Confusion Matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-with-non-matches-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      3. With Non-Matches Documentation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-evaluator-format" class="md-nav__link">
    <span class="md-ellipsis">
      4. Evaluator Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-complete-parameter-reference" class="md-nav__link">
    <span class="md-ellipsis">
      5. Complete Parameter Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#universal-aggregate-fields-new-feature" class="md-nav__link">
    <span class="md-ellipsis">
      Universal Aggregate Fields (NEW FEATURE)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Universal Aggregate Fields (NEW FEATURE)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-are-aggregate-fields" class="md-nav__link">
    <span class="md-ellipsis">
      What Are Aggregate Fields?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure" class="md-nav__link">
    <span class="md-ellipsis">
      Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    <span class="md-ellipsis">
      Benefits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-method" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Method
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the Method">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-options" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregate-field-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregate Field Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../StructuredModel_Dynamic_Creation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    StructuredModel from JSON
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../StructuredModel_Advanced_Functionality/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    StructuredModel Advanced Functionality
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Universal_Aggregate_Field_Feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Universal Aggregate Field
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    SDK Docs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            SDK Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SDK-Docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SDK Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SDK-Docs/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SDK-Docs/comparators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comparators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SDK-Docs/evaluator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Evaluator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SDK-Docs/models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SDK-Docs/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-it-does" class="md-nav__link">
    <span class="md-ellipsis">
      What It Does
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-it-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why It Matters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      How It Works
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How It Works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-big-picture" class="md-nav__link">
    <span class="md-ellipsis">
      The Big Picture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-process-step-by-step" class="md-nav__link">
    <span class="md-ellipsis">
      The Process Step-by-Step
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flow-chart" class="md-nav__link">
    <span class="md-ellipsis">
      Flow Chart
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pseudocode-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Pseudocode Logic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pseudocode Logic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-compare_with-method" class="md-nav__link">
    <span class="md-ellipsis">
      Core compare_with Method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-recursive-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Core Recursive Comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-type-dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      Field Type Dispatch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-matching-hungarian-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      List Matching (Hungarian Algorithm)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structured-list-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Structured List Processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Key Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-field-types" class="md-nav__link">
    <span class="md-ellipsis">
      1. Field Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-hungarian-matching" class="md-nav__link">
    <span class="md-ellipsis">
      2. Hungarian Matching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-thresholds-and-weights" class="md-nav__link">
    <span class="md-ellipsis">
      3. Thresholds and Weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-confusion-matrix-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      4. Confusion Matrix Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-score-percolation" class="md-nav__link">
    <span class="md-ellipsis">
      5. Score Percolation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-simple-invoice-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Example 1: Simple Invoice Comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-list-comparison-with-hungarian-matching" class="md-nav__link">
    <span class="md-ellipsis">
      Example 2: List Comparison with Hungarian Matching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-nested-object-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Example 3: Nested Object Comparison
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      Core Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Helper Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#design-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Design Principles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-flow-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      Method Flow Breakdown
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Method Flow Breakdown">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-entry-point-compare_with" class="md-nav__link">
    <span class="md-ellipsis">
      1. Entry Point: compare_with()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-core-engine-compare_recursive" class="md-nav__link">
    <span class="md-ellipsis">
      2. Core Engine: compare_recursive()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-field-dispatcher-_dispatch_field_comparison" class="md-nav__link">
    <span class="md-ellipsis">
      3. Field Dispatcher: _dispatch_field_comparison()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-specialized-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      4. Specialized Handlers:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-hungarian-matching" class="md-nav__link">
    <span class="md-ellipsis">
      5. Hungarian Matching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-score-calculation-and-aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      6. Score Calculation and Aggregation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Optimizations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-output-structure-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Output Structure Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Output Structure Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-basic-output-default-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      1. Basic Output (Default Parameters)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-with-confusion-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      2. With Confusion Matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-with-non-matches-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      3. With Non-Matches Documentation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-evaluator-format" class="md-nav__link">
    <span class="md-ellipsis">
      4. Evaluator Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-complete-parameter-reference" class="md-nav__link">
    <span class="md-ellipsis">
      5. Complete Parameter Reference
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#universal-aggregate-fields-new-feature" class="md-nav__link">
    <span class="md-ellipsis">
      Universal Aggregate Fields (NEW FEATURE)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Universal Aggregate Fields (NEW FEATURE)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-are-aggregate-fields" class="md-nav__link">
    <span class="md-ellipsis">
      What Are Aggregate Fields?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure" class="md-nav__link">
    <span class="md-ellipsis">
      Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    <span class="md-ellipsis">
      Benefits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-method" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Method
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the Method">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-options" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregate-field-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregate Field Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="structuredmodel-compare_with-method-a-laymans-guide">StructuredModel <code>compare_with</code> Method: A Layman's Guide</h1>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#what-it-does">What It Does</a></li>
<li><a href="#why-it-matters">Why It Matters</a></li>
<li><a href="#how-it-works">How It Works</a></li>
<li><a href="#flow-chart">Flow Chart</a></li>
<li><a href="#key-concepts">Key Concepts</a></li>
<li><a href="#examples">Examples</a></li>
<li><a href="#architecture-overview">Architecture Overview</a></li>
</ol>
<h2 id="what-it-does">What It Does</h2>
<p>The <code>compare_with</code> method is like having a super-smart assistant that can compare two complex documents (like invoices, contracts, or product catalogs) and tell you:</p>
<ul>
<li><strong>How similar they are</strong> (as a percentage score)</li>
<li><strong>Which specific parts match or don't match</strong> (field-by-field analysis)</li>
<li><strong>Detailed statistics</strong> about the comparison (like how many items were correct, incorrect, or missing)</li>
</ul>
<p>Think of it like comparing two shopping receipts - but instead of just looking at totals, it can compare every line item, every date, every store detail, and even handle cases where items are in different orders or some information is missing.</p>
<h2 id="why-it-matters">Why It Matters</h2>
<p>This system is crucial for:</p>
<ul>
<li><strong>Document Processing</strong>: Automatically checking if extracted data matches expected formats</li>
<li><strong>Quality Assurance</strong>: Validating that AI systems correctly understand documents</li>
<li><strong>Data Migration</strong>: Ensuring data transfers preserve all important information</li>
<li><strong>Compliance</strong>: Proving that automated systems meet accuracy requirements</li>
</ul>
<h2 id="how-it-works">How It Works</h2>
<h3 id="the-big-picture">The Big Picture</h3>
<ol>
<li><strong>Start</strong>: You give it two structured objects to compare (like two invoices)</li>
<li><strong>Field-by-Field Analysis</strong>: It looks at every piece of information in both objects</li>
<li><strong>Smart Matching</strong>: For lists of items, it figures out which items should be compared to each other</li>
<li><strong>Scoring</strong>: It calculates how similar each part is and combines them into an overall score</li>
<li><strong>Detailed Report</strong>: It gives you both a simple score and detailed breakdown</li>
</ol>
<h3 id="the-process-step-by-step">The Process Step-by-Step</h3>
<ol>
<li><strong>Preparation</strong>: The method receives two objects and comparison options</li>
<li><strong>Recursive Traversal</strong>: It walks through every field in both objects simultaneously</li>
<li><strong>Type-Specific Handling</strong>: Different types of data get different comparison treatments:</li>
<li>Simple text/numbers: Direct comparison</li>
<li>Lists: Smart matching to pair up similar items</li>
<li>Nested objects: Recursive comparison of sub-fields</li>
<li><strong>Score Calculation</strong>: Each comparison gets a similarity score (0.0 to 1.0)</li>
<li><strong>Aggregation</strong>: All scores are combined using weighted averages</li>
<li><strong>Result Assembly</strong>: Final results include scores, statistics, and detailed breakdowns</li>
</ol>
<h2 id="flow-chart">Flow Chart</h2>
<div class="highlight"><pre><span></span><code>┌─────────────────────────┐
│   compare_with()        │ ← Entry Point
│   (Public Interface)    │
└─────────┬───────────────┘
          │
          ▼
┌─────────────────────────┐
│   compare_recursive()   │ ← Core Logic Engine
│   (Single Traversal)    │
└─────────┬───────────────┘
          │
          ▼
┌─────────────────────────┐
│   For Each Field:       │
│   _dispatch_field_      │ ← Field Processing Loop
│   _comparison()         │
└─────────┬───────────────┘
          │
          ▼
┌─────────────────────────┐
│   Field Type Check      │ ← Decision Point
└─────┬─────┬─────┬───────┘
      │     │     │
      ▼     ▼     ▼
┌─────────┐ ┌─────────┐ ┌─────────────┐
│Primitive│ │  List   │ │   Nested    │
│  Field  │ │  Field  │ │   Object    │
└────┬────┘ └────┬────┘ └──────┬──────┘
     │           │             │
     │           ▼             │
     │    ┌─────────────┐      │
     │    │  Hungarian  │      │ ← Smart List Matching
     │    │  Matching   │      │
     │    └──────┬──────┘      │
     │           │             │
     ▼           ▼             ▼
┌─────────────────────────────────┐
│     Score Calculation &amp;        │ ← Similarity Assessment
│     Threshold Application      │
└─────────────┬───────────────────┘
              │
              ▼
┌─────────────────────────────────┐
│    Result Aggregation &amp;        │ ← Combine All Results
│    Score Percolation           │
└─────────────┬───────────────────┘
              │
              ▼
┌─────────────────────────────────┐
│     Format Final Result        │ ← Output Generation
└─────────────────────────────────┘
</code></pre></div>
<h2 id="pseudocode-logic">Pseudocode Logic</h2>
<h3 id="core-compare_with-method">Core <code>compare_with</code> Method</h3>
<div class="highlight"><pre><span></span><code>Algorithm: compare_with(other_model, options)
Input: other_model (StructuredModel), options (dict)

1. CALL recursive_result = compare_recursive(other_model)
2. EXTRACT field_scores from recursive_result
3. EXTRACT overall_score from recursive_result
4. EXTRACT all_fields_matched from recursive_result

5. CREATE result = {
     field_scores: field_scores,
     overall_score: overall_score,
     all_fields_matched: all_fields_matched
   }

6. IF options.include_confusion_matrix THEN
7.     ADD recursive_result to result.confusion_matrix
8. ENDIF

9. IF options.document_non_matches THEN
10.    ADD non_matches to result.non_matches
11. ENDIF

12. IF options.evaluator_format THEN
13.    TRANSFORM result for evaluator compatibility
14. ENDIF

15. RETURN result
</code></pre></div>
<h3 id="core-recursive-comparison">Core Recursive Comparison</h3>
<div class="highlight"><pre><span></span><code>Algorithm: compare_recursive(other_model)
Input: other_model (StructuredModel)

1. INITIALIZE total_score = 0, total_weight = 0
2. INITIALIZE overall_metrics = {tp: 0, fa: 0, fd: 0, fp: 0, tn: 0, fn: 0}
3. INITIALIZE field_results = {}

4. FOR each field_name IN model_fields DO
5.     GET gt_value = get_field(field_name)
6.     GET pred_value = other_model.get_field(field_name)
7.     
8.     CALL field_result = dispatch_field_comparison(field_name, gt_value, pred_value)
9.     
10.    SET field_results[field_name] = field_result
11.    AGGREGATE field_result INTO overall_metrics
12.    
13.    UPDATE total_score += field_result.score × field_result.weight
14.    UPDATE total_weight += field_result.weight
15. ENDFOR

16. CALCULATE overall_score = total_score / total_weight
17. RETURN {overall: overall_metrics, fields: field_results, overall_score: overall_score}
</code></pre></div>
<h3 id="field-type-dispatch">Field Type Dispatch</h3>
<div class="highlight"><pre><span></span><code>Algorithm: dispatch_field_comparison(field_name, gt_val, pred_val)
Input: field_name (string), gt_val (any), pred_val (any)

1. GET field_config = get_field_config(field_name)
2. 
3. IF both_null(gt_val, pred_val) THEN
4.     RETURN true_negative_result()
5. ENDIF
6. 
7. IF one_null(gt_val, pred_val) THEN
8.     RETURN false_alarm_or_negative_result()
9. ENDIF
10. 
11. MATCH field_type:
12.     CASE primitive: RETURN compare_primitive(gt_val, pred_val, field_config)
13.     CASE list: RETURN compare_list(gt_val, pred_val, field_config)
14.     CASE nested_object: RETURN compare_nested(gt_val, pred_val, field_config)
15. ENDMATCH
</code></pre></div>
<h3 id="list-matching-hungarian-algorithm">List Matching (Hungarian Algorithm)</h3>
<div class="highlight"><pre><span></span><code>Algorithm: hungarian_list_matching(gt_list, pred_list, config)
Input: gt_list, pred_list, config

1. IF both_empty(gt_list, pred_list) THEN
2.     RETURN perfect_match()
3. ENDIF

4. IF one_empty(gt_list, pred_list) THEN
5.     RETURN count_unmatched_items()
6. ENDIF

7. BUILD similarity_matrix FOR all pairs
8. RUN hungarian_algorithm(similarity_matrix)
9. GET matched_pairs WITH similarity_scores

10. CLASSIFY matches:
11.     IF similarity ≥ threshold THEN tp++
12.     ELSE fd++

13. COUNT unmatched_items:
14.     fn = unmatched_gt_items
15.     fa = unmatched_pred_items

16. CALCULATE overall_score = average_similarity × coverage_ratio
17. RETURN {tp, fd, fa, fn, overall_score, matched_pairs}
</code></pre></div>
<h3 id="structured-list-processing">Structured List Processing</h3>
<div class="highlight"><pre><span></span><code>Algorithm: compare_struct_list(gt_list, pred_list, field_name)
Input: gt_list, pred_list, field_name

1. GET match_threshold FROM gt_list[0].__class__
2. 
3. HANDLE empty_cases:
4.     IF both_empty THEN RETURN true_negative
5.     IF one_empty THEN RETURN false_alarms_or_negatives
6. 
7. RUN hungarian_matching(gt_list, pred_list)
8. GET matched_pairs WITH object_similarities
9. 
10. CLASSIFY objects:
11.     IF object_similarity ≥ match_threshold THEN tp_objects++
12.     ELSE fd_objects++
13. 
14. FOR good_matches_only DO
15.     FOR each sub_field IN object_fields DO
16.         COMPARE sub_field_values
17.         AGGREGATE sub_field_metrics
18.     ENDFOR
19. ENDFOR
20. 
21. RETURN {object_metrics, field_details, overall_score}
</code></pre></div>
<h2 id="key-concepts">Key Concepts</h2>
<h3 id="1-field-types">1. <strong>Field Types</strong></h3>
<ul>
<li><strong>Primitive Fields</strong>: Simple data like names, dates, numbers</li>
<li><strong>List Fields</strong>: Collections of items (like transaction lists)</li>
<li><strong>Nested Objects</strong>: Complex structures containing other fields</li>
</ul>
<h3 id="2-hungarian-matching">2. <strong>Hungarian Matching</strong></h3>
<p>For lists of items (like products in an order), the system uses a sophisticated algorithm to figure out which items in list A should be compared to which items in list B. This handles cases where:
- Items are in different orders
- Some items are missing
- Lists have different lengths</p>
<p><strong>Example</strong>: 
<div class="highlight"><pre><span></span><code>Ground Truth: [Apple, Banana, Cherry]
Prediction:   [Banana, Apple, Orange]
</code></pre></div>
The algorithm pairs: Apple↔Apple, Banana↔Banana, and notes Cherry is missing while Orange is extra.</p>
<h3 id="3-thresholds-and-weights">3. <strong>Thresholds and Weights</strong></h3>
<ul>
<li><strong>Threshold</strong>: Minimum similarity score to consider two items as "matching" (e.g., 0.7 = 70%)</li>
<li><strong>Weight</strong>: How important each field is in the overall score (e.g., customer name might be weighted higher than order date)</li>
</ul>
<h3 id="4-confusion-matrix-metrics">4. <strong>Confusion Matrix Metrics</strong></h3>
<p>The system tracks detailed statistics:
- <strong>True Positives (TP)</strong>: Correctly identified matches
- <strong>False Positives (FP)</strong>: Incorrectly claimed matches<br />
- <strong>False Negatives (FN)</strong>: Missed actual matches
- <strong>True Negatives (TN)</strong>: Correctly identified non-matches</p>
<h3 id="5-score-percolation">5. <strong>Score Percolation</strong></h3>
<p>Scores "bubble up" from detailed fields to overall scores:
<div class="highlight"><pre><span></span><code>Field Level:    name=0.9, date=1.0, amount=0.8
↓
Object Level:   Weighted average = 0.9
↓  
Document Level: Overall similarity = 0.9
</code></pre></div></p>
<h2 id="examples">Examples</h2>
<h3 id="example-1-simple-invoice-comparison">Example 1: Simple Invoice Comparison</h3>
<p><strong>Ground Truth Invoice</strong>:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;invoice_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INV-001&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-01-15&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;amount&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">150.00</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>Predicted Invoice</strong>:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;invoice_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INV-001&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-01-15&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nt">&quot;amount&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">155.00</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>Result</strong>:
- <code>invoice_number</code>: 1.0 (exact match)
- <code>date</code>: 1.0 (exact match)
- <code>amount</code>: 0.0 (differs by more than threshold)
- <strong>Overall Score</strong>: 0.67 (2 out of 3 fields match)</p>
<h3 id="example-2-list-comparison-with-hungarian-matching">Example 2: List Comparison with Hungarian Matching</h3>
<p><strong>Ground Truth Products</strong>:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;products&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Widget A&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">10.00</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Widget B&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">20.00</span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>Predicted Products</strong>:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;products&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Widget B&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">20.00</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Widget A&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">10.50</span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>Hungarian Matching Process</strong>:
1. Calculate similarity between all pairs
2. Find optimal assignment: GT[0]↔Pred[1], GT[1]↔Pred[0]
3. Compare matched pairs:
   - Widget A vs Widget A: High similarity (price slightly off)
   - Widget B vs Widget B: Perfect match</p>
<h3 id="example-3-nested-object-comparison">Example 3: Nested Object Comparison</h3>
<p><strong>Ground Truth Customer</strong>:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;street&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;123 Main St&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;city&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Springfield&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;zip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;12345&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>The system recursively compares:
1. Top-level <code>name</code> field
2. Nested <code>address</code> object:
   - <code>address.street</code>
   - <code>address.city</code> 
   - <code>address.zip</code></p>
<p>Each nested field contributes to the overall score.</p>
<h2 id="architecture-overview">Architecture Overview</h2>
<h3 id="core-components">Core Components</h3>
<ol>
<li><strong>StructuredModel</strong>: The main class that defines comparable data structures</li>
<li><strong>ComparableField</strong>: Configuration for how each field should be compared</li>
<li><strong>ComparisonHelper</strong>: Utilities for field-level comparisons</li>
<li><strong>HungarianHelper</strong>: Implements the Hungarian matching algorithm</li>
<li><strong>Various Helpers</strong>: Specialized utilities for thresholds, metrics, formatting</li>
</ol>
<h3 id="helper-classes">Helper Classes</h3>
<ul>
<li><strong>MetricsHelper</strong>: Calculates precision, recall, F1-score, etc.</li>
<li><strong>ThresholdHelper</strong>: Handles threshold application and edge cases  </li>
<li><strong>NonMatchesHelper</strong>: Documents what didn't match for debugging</li>
<li><strong>FieldHelper</strong>: Utilities for field type detection and null handling</li>
<li><strong>ConfigurationHelper</strong>: Manages field comparison settings</li>
</ul>
<h3 id="design-principles">Design Principles</h3>
<ol>
<li>
<p><strong>Single Traversal Optimization</strong>: The system walks through the object structure only once, gathering both similarity scores and confusion matrix data simultaneously. This is much more efficient than separate passes.</p>
</li>
<li>
<p><strong>Type-Based Dispatch</strong>: Different field types get different treatment:</p>
</li>
<li><strong>Primitives</strong>: Direct comparator application with threshold checking</li>
<li><strong>Lists</strong>: Hungarian matching for optimal pairing</li>
<li>
<p><strong>Nested Objects</strong>: Recursive descent into sub-structures</p>
</li>
<li>
<p><strong>Threshold-Gated Recursion</strong>: For complex nested structures, the system only performs detailed analysis on object pairs that meet similarity thresholds. Poor matches are treated as atomic failures.</p>
</li>
<li>
<p><strong>Hierarchical Result Structure</strong>: Results maintain the same nested structure as the input objects, making it easy to understand which specific parts matched or failed.</p>
</li>
</ol>
<h3 id="method-flow-breakdown">Method Flow Breakdown</h3>
<h4 id="1-entry-point-compare_with">1. Entry Point: <code>compare_with()</code></h4>
<ul>
<li><strong>Purpose</strong>: Public API that orchestrates the comparison</li>
<li><strong>Parameters</strong>: </li>
<li><code>other</code>: The object to compare against</li>
<li><code>include_confusion_matrix</code>: Whether to include detailed metrics</li>
<li><code>document_non_matches</code>: Whether to document failures</li>
<li><code>evaluator_format</code>: Whether to format for evaluation tools</li>
<li><strong>Returns</strong>: Comprehensive comparison results</li>
</ul>
<h4 id="2-core-engine-compare_recursive">2. Core Engine: <code>compare_recursive()</code></h4>
<ul>
<li><strong>Purpose</strong>: Single-traversal comparison engine</li>
<li><strong>Key Innovation</strong>: Gathers similarity scores AND confusion matrix data in one pass</li>
<li><strong>Output</strong>: Hierarchical result structure with metrics at every level</li>
</ul>
<h4 id="3-field-dispatcher-_dispatch_field_comparison">3. Field Dispatcher: <code>_dispatch_field_comparison()</code></h4>
<ul>
<li><strong>Purpose</strong>: Routes each field to appropriate comparison logic based on type</li>
<li><strong>Handles</strong>: Null checks, type detection, and routing to specialized handlers</li>
<li><strong>Uses Match Statements</strong>: Clean, efficient type-based routing</li>
</ul>
<h4 id="4-specialized-handlers">4. Specialized Handlers:</h4>
<p><strong><code>_compare_primitive_with_scores()</code></strong>:
- Handles simple fields (strings, numbers, dates)
- Applies comparators (Levenshtein, exact match, etc.)
- Converts similarity scores to binary classification metrics</p>
<p><strong><code>_compare_primitive_list_with_scores()</code></strong>:
- Handles lists of simple items
- Uses Hungarian matching for optimal pairing
- Handles unmatched items as false positives/negatives</p>
<p><strong><code>_compare_struct_list_with_scores()</code></strong>:
- Handles lists of complex objects
- Uses object-level Hungarian matching
- Supports threshold-gated recursion for field-level details
- Maintains separation between object-level and field-level metrics</p>
<h4 id="5-hungarian-matching">5. Hungarian Matching</h4>
<ul>
<li><strong>Algorithm</strong>: Optimal bipartite matching using the Hungarian algorithm</li>
<li><strong>Handles</strong>: Different list lengths, optimal pairing, similarity scoring</li>
<li><strong>Output</strong>: Matched pairs with similarity scores, plus unmatched items</li>
</ul>
<h4 id="6-score-calculation-and-aggregation">6. Score Calculation and Aggregation</h4>
<ul>
<li><strong>Raw Scores</strong>: Direct comparator outputs (0.0 to 1.0)</li>
<li><strong>Threshold Application</strong>: Convert to binary pass/fail based on thresholds</li>
<li><strong>Weight Application</strong>: Combine field scores using configured weights</li>
<li><strong>Percolation</strong>: Bubble up scores from leaf fields to parent objects</li>
</ul>
<h3 id="performance-optimizations">Performance Optimizations</h3>
<ol>
<li><strong>Single Traversal</strong>: Eliminates redundant object walks</li>
<li><strong>Lazy Evaluation</strong>: Only calculates detailed metrics when requested</li>
<li><strong>Threshold Gating</strong>: Skips expensive recursion for poor matches</li>
<li><strong>Efficient Matching</strong>: Hungarian algorithm runs in O(n³) time</li>
</ol>
<h3 id="error-handling">Error Handling</h3>
<ul>
<li><strong>Type Mismatches</strong>: Graceful handling when field types don't match</li>
<li><strong>Missing Fields</strong>: Treats as null for comparison purposes</li>
<li><strong>Circular References</strong>: Prevented through proper object traversal</li>
<li><strong>Memory Management</strong>: Efficient result structure prevents memory bloat</li>
</ul>
<h2 id="complete-output-structure-reference">Complete Output Structure Reference</h2>
<p>The <code>compare_with</code> method returns different structures based on the parameters provided. Here's the complete reference:</p>
<h3 id="1-basic-output-default-parameters">1. Basic Output (Default Parameters)</h3>
<div class="highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">compare_with</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span>
</code></pre></div>
<p><strong>Structure</strong>:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;field_scores&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;field_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.85</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;another_field&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;overall_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.92</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;all_fields_matched&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>Fields</strong>:
- <code>field_scores</code>: Dictionary mapping field names to similarity scores (0.0-1.0)
- <code>overall_score</code>: Weighted average of all field scores (0.0-1.0)
- <code>all_fields_matched</code>: Boolean indicating if all fields met their thresholds</p>
<h3 id="2-with-confusion-matrix">2. With Confusion Matrix</h3>
<div class="highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">compare_with</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">include_confusion_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p><strong>Structure</strong>:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;field_scores&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;overall_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.92</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;all_fields_matched&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;confusion_matrix&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;overall&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;tp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fa&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fd&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;tn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;similarity_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.92</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;all_fields_matched&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;derived&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;cm_precision&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.83</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;cm_recall&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.91</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;cm_f1&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.87</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;cm_accuracy&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.85</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;field_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;overall&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;tp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fa&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fd&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;tn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;similarity_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;all_fields_matched&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">        </span><span class="nt">&quot;aggregate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;tp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fa&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fd&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;tn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;derived&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;cm_precision&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;cm_recall&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;cm_f1&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;cm_accuracy&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;non_matches&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">    </span><span class="nt">&quot;aggregate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;tp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fa&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fd&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;tn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;derived&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;cm_precision&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.83</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;cm_recall&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.91</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;cm_f1&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.87</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;cm_accuracy&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.85</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>Key Features</strong>:
- <strong>Universal Aggregate Fields</strong>: Every node includes an <code>aggregate</code> field that sums all primitive field metrics below that node
- <strong>Hierarchical Structure</strong>: Maintains the same nested structure as your data models
- <strong>Derived Metrics</strong>: Automatic calculation of precision, recall, F1-score, and accuracy
- <strong>Field-Level Granularity</strong>: Access confusion matrix metrics at any level of nesting</p>
<h3 id="3-with-non-matches-documentation">3. With Non-Matches Documentation</h3>
<div class="highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">compare_with</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">document_non_matches</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p><strong>Additional Field</strong>:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;non_matches&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;field_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;contact.phone&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;non_match_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;false_discovery&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;ground_truth_value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;555-123-4567&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;prediction_value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;555-999-8888&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;similarity_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.3</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;details&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;below threshold (0.300 &lt; 1.0)&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>Non-Match Types</strong>:
- <code>false_discovery</code>: Fields that don't meet similarity threshold
- <code>false_alarm</code>: Predicted fields that shouldn't exist
- <code>false_negative</code>: Missing fields that should exist</p>
<h3 id="4-evaluator-format">4. Evaluator Format</h3>
<div class="highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">compare_with</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">evaluator_format</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p><strong>Structure</strong> (Optimized for evaluation tools):
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;overall&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;precision&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.83</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;recall&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.91</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;f1&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.87</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;accuracy&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.85</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;anls_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.89</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;field_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;precision&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;recall&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;f1&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;accuracy&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;confusion_matrix&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">  </span><span class="nt">&quot;non_matches&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="5-complete-parameter-reference">5. Complete Parameter Reference</h3>
<div class="highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">compare_with</span><span class="p">(</span>
    <span class="n">other</span><span class="p">,</span>                      <span class="c1"># Required: Model to compare against</span>
    <span class="n">include_confusion_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>   <span class="c1"># Include detailed metrics</span>
    <span class="n">document_non_matches</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>       <span class="c1"># Document what didn&#39;t match</span>
    <span class="n">evaluator_format</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>          <span class="c1"># Format for evaluation tools</span>
    <span class="n">recall_with_fd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>           <span class="c1"># Include FD in recall calculation</span>
    <span class="n">add_derived_metrics</span><span class="o">=</span><span class="kc">True</span>        <span class="c1"># Add precision/recall/F1 metrics</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="universal-aggregate-fields-new-feature">Universal Aggregate Fields (NEW FEATURE)</h2>
<h3 id="what-are-aggregate-fields">What Are Aggregate Fields?</h3>
<p>Every node in the confusion matrix now automatically includes an <code>aggregate</code> field that contains the sum of all primitive field confusion matrices below that node. This provides universal field-level granularity without any configuration.</p>
<h3 id="structure">Structure</h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;confusion_matrix&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;aggregate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;tp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fa&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fd&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;tn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;derived&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;contact&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;aggregate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;tp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fa&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fd&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;tn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;derived&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;phone&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;aggregate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;tp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fa&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fd&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;tn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;fn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;derived&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="benefits">Benefits</h3>
<ol>
<li><strong>Universal Access</strong>: Get aggregate metrics at any level without configuration</li>
<li><strong>Hierarchical Analysis</strong>: Understand which sections of your data have issues</li>
<li><strong>Automatic</strong>: Works out of the box for all comparisons</li>
<li><strong>Consistent</strong>: Every node has the same structure</li>
</ol>
<h3 id="usage-examples">Usage Examples</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Get total primitive field metrics across entire comparison</span>
<span class="n">total_tp</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;confusion_matrix&#39;</span><span class="p">][</span><span class="s1">&#39;aggregate&#39;</span><span class="p">][</span><span class="s1">&#39;tp&#39;</span><span class="p">]</span>

<span class="c1"># Get metrics for a specific section (e.g., contact information)</span>
<span class="n">contact_metrics</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;confusion_matrix&#39;</span><span class="p">][</span><span class="s1">&#39;fields&#39;</span><span class="p">][</span><span class="s1">&#39;contact&#39;</span><span class="p">][</span><span class="s1">&#39;aggregate&#39;</span><span class="p">]</span>
<span class="n">contact_f1</span> <span class="o">=</span> <span class="n">contact_metrics</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">][</span><span class="s1">&#39;cm_f1&#39;</span><span class="p">]</span>

<span class="c1"># Get metrics for deeply nested fields</span>
<span class="n">address_metrics</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;confusion_matrix&#39;</span><span class="p">][</span><span class="s1">&#39;fields&#39;</span><span class="p">][</span><span class="s1">&#39;customer&#39;</span><span class="p">][</span><span class="s1">&#39;fields&#39;</span><span class="p">][</span><span class="s1">&#39;address&#39;</span><span class="p">][</span><span class="s1">&#39;aggregate&#39;</span><span class="p">]</span>
</code></pre></div>
<h2 id="using-the-method">Using the Method</h2>
<h3 id="basic-usage">Basic Usage</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Simple comparison</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">compare_with</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall similarity: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;overall_score&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># With detailed metrics</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">compare_with</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">include_confusion_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">confusion_matrix</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;confusion_matrix&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True Positives: </span><span class="si">{</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="s1">&#39;overall&#39;</span><span class="p">][</span><span class="s1">&#39;tp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Access universal aggregate fields</span>
<span class="n">total_aggregate</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">[</span><span class="s1">&#39;aggregate&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total primitive TP: </span><span class="si">{</span><span class="n">total_aggregate</span><span class="p">[</span><span class="s1">&#39;tp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall F1: </span><span class="si">{</span><span class="n">total_aggregate</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">][</span><span class="s1">&#39;cm_f1&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="advanced-options">Advanced Options</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Complete analysis with non-match documentation</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">compare_with</span><span class="p">(</span>
    <span class="n">model2</span><span class="p">,</span>
    <span class="n">include_confusion_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">document_non_matches</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">evaluator_format</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="c1"># Access field-level scores</span>
<span class="n">field_scores</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;field_scores&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">field_scores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Access hierarchical aggregate metrics</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;confusion_matrix&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_data</span> <span class="ow">in</span> <span class="n">cm</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;aggregate&#39;</span> <span class="ow">in</span> <span class="n">field_data</span><span class="p">:</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">field_data</span><span class="p">[</span><span class="s1">&#39;aggregate&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2"> section F1: </span><span class="si">{</span><span class="n">agg</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">][</span><span class="s1">&#39;cm_f1&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Access non-matches for debugging</span>
<span class="n">non_matches</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;non_matches&#39;</span><span class="p">,</span> <span class="p">[])</span>
<span class="k">for</span> <span class="n">nm</span> <span class="ow">in</span> <span class="n">non_matches</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Field </span><span class="si">{</span><span class="n">nm</span><span class="p">[</span><span class="s1">&#39;field_path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">nm</span><span class="p">[</span><span class="s1">&#39;non_match_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="aggregate-field-analysis">Aggregate Field Analysis</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Analyze performance by data section</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">compare_with</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">include_confusion_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;confusion_matrix&#39;</span><span class="p">]</span>

<span class="c1"># Top-level summary</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== OVERALL PERFORMANCE ===&quot;</span><span class="p">)</span>
<span class="n">total_agg</span> <span class="o">=</span> <span class="n">cm</span><span class="p">[</span><span class="s1">&#39;aggregate&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Precision: </span><span class="si">{</span><span class="n">total_agg</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">][</span><span class="s1">&#39;cm_precision&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Recall: </span><span class="si">{</span><span class="n">total_agg</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">][</span><span class="s1">&#39;cm_recall&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total F1: </span><span class="si">{</span><span class="n">total_agg</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">][</span><span class="s1">&#39;cm_f1&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Section-by-section analysis</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== SECTION PERFORMANCE ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">section_name</span><span class="p">,</span> <span class="n">section_data</span> <span class="ow">in</span> <span class="n">cm</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;aggregate&#39;</span> <span class="ow">in</span> <span class="n">section_data</span><span class="p">:</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">section_data</span><span class="p">[</span><span class="s1">&#39;aggregate&#39;</span><span class="p">]</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">agg</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">][</span><span class="s1">&#39;cm_f1&#39;</span><span class="p">]</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="n">agg</span><span class="p">[</span><span class="s1">&#39;tp&#39;</span><span class="p">]</span>
        <span class="n">total_errors</span> <span class="o">=</span> <span class="n">agg</span><span class="p">[</span><span class="s1">&#39;fd&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">agg</span><span class="p">[</span><span class="s1">&#39;fa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">agg</span><span class="p">[</span><span class="s1">&#39;fn&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">section_name</span><span class="si">}</span><span class="s2">: F1=</span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, TP=</span><span class="si">{</span><span class="n">tp</span><span class="si">}</span><span class="s2">, Errors=</span><span class="si">{</span><span class="n">total_errors</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="conclusion">Conclusion</h2>
<p>The <code>compare_with</code> method represents a sophisticated document comparison system that balances accuracy, performance, and usability. It provides both simple similarity scores for basic use cases and detailed analytical data for advanced evaluation scenarios.</p>
<p>The method's strength lies in its ability to handle complex, nested data structures while maintaining interpretable results that can guide both automated systems and human reviewers in understanding how well document processing systems are performing.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
        <script src="../../assets/auto-redirect.js"></script>
      
    
  </body>
</html>